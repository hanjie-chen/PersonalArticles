# deamon process

简化守护进程标准流程如下

1. `fork()` 一个子进程 → 主进程退出 → 子进程成为“孤儿”进程（由 PID 1 管理）
2. `setsid()` → 脱离控制终端，成为新的 session leader
3. `setpgid()` → 设置自己的进程组（pgid）
4. `chdir("/")`、关闭标准输入输出等，彻底“脱离用户空间”

## 为什么守护进程要脱离控制终端？

背后的设计初衷：

守护进程（daemon）本质上是后台运行的服务，不属于任何用户交互进程。为了避免和用户登录会话有关联，它必须做到：

| 操作                    | 原因                             |
| ----------------------- | -------------------------------- |
| `fork()` 之后父进程退出 | 脱离原始 shell 的控制            |
| `setsid()`              | 创建新的会话，并**脱离控制终端** |
| `chdir("/")`            | 防止占用挂载目录                 |
| 重定向 stdin/out/err    | 不依赖任何终端输出               |
| `umask(0)`              | 自己控制文件权限                 |

### 脱离终端的关键目的是：

- 不受 Ctrl+C / Ctrl+Z 等信号干扰
- 防止登录用户退出时进程被 kill
- 作为独立服务存在，系统重启自动拉起，不依赖“谁先登录”



